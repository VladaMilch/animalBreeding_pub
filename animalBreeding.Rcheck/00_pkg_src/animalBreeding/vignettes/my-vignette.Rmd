---
title: "Package 'animalBreeding'"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{my-vignette}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```

# Setup

For installation, run the code below.

```{r, eval = FALSE}
library(devtools)
install_github("IMSBComputationalBiology/animalBreedingProj",
               subdir="animalBreeding",
               auth_token = "f6024685998b779a9db258994a7b4e44468b754c",
               force=TRUE)
```

```{r setup, message=FALSE, comment=FALSE, cache=FALSE, results=FALSE}
library(animalBreeding)
```

At the moment, the package repository is private, therefore
the installation will only work with the `auth_token` argument. 
Later it will be replaced.

# Usage

## Reproducing Table 3.12

To reproduce Table 3.12 from the "Animal production and breeding" textbook, 
use the `calculate_needed_litters()` function. For instance, the number of 
litters required to give 97.5% probability of achieving 25 animals, with the 
average litter size being 4, is 10.  

```{r}
calculate_needed_litters_textbook(
    condifence_p = 0.975, 
    litter_mean = 4, 
    litter_sd = 2.5,
    n_needed = 25)
```

Note that the calculation above uses values for the quantiles of the Gaussian 
distribution. Quite likely, the authors of the textbook used a different 
approximation from the one I use now. 

Warning: The smallest integer that 
guarantees $P\geq 0.975$ would be 11 in the case above, but in agreement with 
what the authors did, I just rounded the values.

## Reproducing Table 3.13

To reproduce Table 3.13 from the "Animal production and breeding" textbook, use 
the `calculate_needed_breedings()` function. For instance, the number of 
breedings required to give 97.5% probability of achieving more than 10 
litters,  with the effective fertility being 20%, is 119 (according to 
the textbook). 

```{r}
calculate_needed_breedings_textbook(
    condifence_p = 0.975, 
    effective_fertility_p = 0.2, 
    n_litters = 15,
    calculation_type='textbook_exact')

```

The values I get when implementing the exact same model are slightly 
different, possibly due to the approximations the authors used, 
and the subtle difference between $P(X \leq x)$ and $P(X < x)$.

Thus, for the same figures as above, one would need 113 breedings but not 119.

```{r}
calculate_needed_breedings_textbook(
    condifence_p = 0.975, 
    effective_fertility_p = 0.2, 
    n_litters = 15,
    calculation_type='')
```

Below I check that the calculation was correct. To confirm that `pbinom` 
calculates $P(X \leq x)$ see the `lower.tail` argument in the `?pbinom` 
description.
```{r}
# probability to get 10 or more litters from 110 breedings
1 - pbinom(q = 14, size = 113, prob = 0.2)

# probability to get 10 or more litters from 109 breedings
1 - pbinom(q = 14, size = 112, prob = 0.2)

# thus, 110 is the minimal required number of breedings to have P>0.975
```


## Wrapper

To calculate the number of breedings directly from the required number of 
offsprings,
run the following:

```{r}
calculate_needed_breedings(
    condifence_p = 0.95, 
    effective_fertility_p = 0.2, 
    n_needed = 25, 
    litter_mean = 4, 
    litter_sd = 2.5 )
```